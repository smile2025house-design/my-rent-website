<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>é–‹å§‹ä½¿ç”¨ï½œå¥½æƒ³ç§Ÿå±‹</title>
  <link rel="icon" type="image/png" href="logo.jpg" />
  <style>
    body {
      font-family: "Noto Sans TC", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #f4f6f9;
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      margin: 0;
    }
    .login-box {
      background: #fff;
      padding: 32px 28px;
      border-radius: 16px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.12);
      width: 360px;
      max-width: 92vw;
      text-align: center;
    }
    .logo-wrap {
      width: 96px;
      height: 96px;
      border-radius: 24px;
      overflow: hidden;
      margin: 0 auto 16px;
      background: #0b5c82;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .logo-wrap img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    h1 {
      font-size: 20px;
      margin: 0 0 4px;
    }
    .subtitle {
      font-size: 13px;
      color: #6b7280;
      margin-bottom: 18px;
      word-break: break-all;
    }
    .field-row {
      display: flex;
      gap: 8px;
      margin-bottom: 12px;
    }
    select, input {
      width: 100%;
      padding: 10px;
      border-radius: 8px;
      border: 1px solid #d1d5db;
      font-size: 14px;
      box-sizing: border-box;
    }
    select {
      max-width: 100px;
    }
    button {
      width: 100%;
      padding: 11px;
      margin: 6px 0;
      border: none;
      border-radius: 999px;
      font-size: 15px;
      font-weight: 500;
      cursor: pointer;
      transition: 0.2s ease;
    }
    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    button:hover:not(:disabled) {
      transform: translateY(-1px);
      box-shadow: 0 2px 6px rgba(0,0,0,0.12);
    }
    #btn-google  { background: #fff; color: #111827; border: 1px solid #d1d5db; }
    #btn-line    { background: #06C755; color: #fff; }
    #btn-email-toggle { background: #374151; color: #fff; }
    #btn-guest   { background: #4b5563; color: #fff; }
    #btn-phone   { background: #f59e0b; color: #fff; }

    .or-row {
      display: flex;
      align-items: center;
      margin: 12px 0;
      color: #9ca3af;
      font-size: 13px;
    }
    .or-row::before,
    .or-row::after {
      content: "";
      flex: 1;
      height: 1px;
      background: #e5e7eb;
    }
    .or-row span {
      padding: 0 10px;
    }

    #email-section {
      display: none;
      margin-top: 8px;
      text-align: left;
    }
    #email-section label {
      font-size: 13px;
      color: #4b5563;
      display: block;
      margin-top: 8px;
      margin-bottom: 2px;
    }
    #status {
      margin-top: 12px;
      font-size: 13px;
      color: #374151;
      min-height: 1.4em;
      text-align: center;
      white-space: pre-line;
    }
    .tip {
      margin-top: 12px;
      font-size: 11px;
      color: #9ca3af;
      line-height: 1.4;
    }
  </style>
</head>
<body>
  <div class="login-box">
    <div class="logo-wrap">
      <img src="logo.jpg" alt="å¥½æƒ³ç§Ÿå±‹" onerror="this.style.display='none'">
    </div>
    <h1>é–‹å§‹ä½¿ç”¨ å¥½æƒ³ç§Ÿå±‹</h1>
    <div class="subtitle">https://my-rent-website-2025.vercel.app</div>

    <div class="field-row">
      <select id="phone-region">
        <option value="+886">+886</option>
      </select>
      <input id="phone-input" type="tel" placeholder="æ‰‹æ©Ÿè™Ÿç¢¼ï¼ˆç›®å‰åƒ…é¡¯ç¤ºç”¨ï¼‰">
    </div>

    <button id="btn-continue-phone">ç¹¼çºŒ</button>

    <div class="or-row"><span>æˆ–</span></div>

    <button id="btn-google">ä½¿ç”¨ Google ç¹¼çºŒ</button>
    <button id="btn-line">ä½¿ç”¨ LINE ç¹¼çºŒ</button>
    <button id="btn-email-toggle">ä½¿ç”¨é›»å­éƒµä»¶ç¹¼çºŒ</button>

    <div id="email-section">
      <label for="email-input">é›»å­éƒµä»¶</label>
      <input id="email-input" type="email" placeholder="è«‹è¼¸å…¥ Email">
      <label for="password-input">å¯†ç¢¼ï¼ˆè‡³å°‘ 6 å­—ï¼‰</label>
      <input id="password-input" type="password" placeholder="è«‹è¼¸å…¥å¯†ç¢¼">
      <button id="btn-email-login">ç™»å…¥ / è¨»å†Š</button>
    </div>

    <button id="btn-guest">ä»¥è¨ªå®¢èº«åˆ†ç¹¼çºŒ</button>

    <div class="or-row"><span>æˆ–</span></div>

    <button id="btn-phone" disabled>æ‰‹æ©Ÿç™»å…¥ï¼ˆå³å°‡é–‹æ”¾ï¼‰</button>

    <p id="status"></p>
    <p class="tip">Logo æª”åç‚º logo.jpgï¼ˆèˆ‡ login.html åŒå±¤ï¼‰<br>è«‹ç¢ºèªæª”æ¡ˆæ”¾ç½®æ­£ç¢ºã€‚</p>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import {
      getAuth,
      signInWithPopup,
      signInWithRedirect,
      getRedirectResult,
      signInAnonymously,
      signInWithEmailAndPassword,
      createUserWithEmailAndPassword,
      GoogleAuthProvider,
      OAuthProvider
    } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

    // ğŸ”‘ ä½ çš„ Firebase è¨­å®š
    const firebaseConfig = {
      apiKey: "AIzaSyDap-cGTy0IKomhHbVQKB3Y-JLZk1pK42w",
      authDomain: "smilehouse-a68bc.firebaseapp.com",
      projectId: "smilehouse-a68bc",
      storageBucket: "smilehouse-a68bc.firebasestorage.app",
      messagingSenderId: "542151591313",
      appId: "1:542151591313:web:e10b10e0b5a083fe75c630",
      measurementId: "G-0Q5LFE84ER"
    };

    const AFTER_LOGIN_URL = "account.html";

    const app  = initializeApp(firebaseConfig);
    const auth = getAuth(app);

    // âœ… æª¢æŸ¥æ˜¯å¦ç‚º LINE redirect å›ä¾†
    getRedirectResult(auth)
      .then((result) => {
        if (result && result.user) {
          console.log("LINE ç™»å…¥æˆåŠŸï¼ˆredirectï¼‰", result.user);
          setStatus("ç™»å…¥æˆåŠŸï¼Œæ­£åœ¨å‰å¾€å€‹äººç°¡ä»‹...");
          window.location.href = AFTER_LOGIN_URL;
        }
      })
      .catch((err) => {
        if (err.code !== "auth/no-auth-event") {
          console.error("LINE redirect error", err);
        }
      });

    const googleProvider = new GoogleAuthProvider();
    const lineProvider   = new OAuthProvider("oidc.oid.line");

    const statusEl       = document.getElementById("status");
    const btnGoogle      = document.getElementById("btn-google");
    const btnLine        = document.getElementById("btn-line");
    const btnGuest       = document.getElementById("btn-guest");
    const btnPhone       = document.getElementById("btn-phone");
    const btnEmailToggle = document.getElementById("btn-email-toggle");
    const emailSection   = document.getElementById("email-section");
    const btnEmailLogin  = document.getElementById("btn-email-login");
    const emailInput     = document.getElementById("email-input");
    const passwordInput  = document.getElementById("password-input");
    const btnContinuePhone = document.getElementById("btn-continue-phone");

    function setStatus(msg) {
      if (statusEl) statusEl.textContent = msg;
    }

    async function signInWithProvider(provider, name) {
      try {
        setStatus(`ä½¿ç”¨ ${name} ç™»å…¥ä¸­...`);
        // æ‰‹æ©Ÿ LINE ç”¨ redirectï¼Œæ¯”è¼ƒç©©å®š
        if (name === "LINE" && /Mobi|Android/i.test(navigator.userAgent)) {
          await signInWithRedirect(auth, provider);
          return;
        }
        await signInWithPopup(auth, provider);
        setStatus("ç™»å…¥æˆåŠŸï¼Œæ­£åœ¨å‰å¾€å€‹äººç°¡ä»‹...");
        window.location.href = AFTER_LOGIN_URL;
      } catch (err) {
        console.error(`${name} LOGIN ERROR`, err);
        setStatus(`${name} ç™»å…¥å¤±æ•—ï¼š${err.message || "æœªçŸ¥éŒ¯èª¤"}`);
      }
    }

    if (btnGoogle) {
      btnGoogle.addEventListener("click", () =>
        signInWithProvider(googleProvider, "Google")
      );
    }

    if (btnLine) {
      btnLine.addEventListener("click", () =>
        signInWithProvider(lineProvider, "LINE")
      );
    }

    if (btnGuest) {
      btnGuest.addEventListener("click", async () => {
        try {
          setStatus("ä»¥è¨ªå®¢èº«åˆ†ç™»å…¥ä¸­...");
          await signInAnonymously(auth);
          window.location.href = AFTER_LOGIN_URL;
        } catch (err) {
          console.error("[GUEST ERROR]", err);
          setStatus("è¨ªå®¢ç™»å…¥å¤±æ•—ï¼š" + err.message);
        }
      });
    }

    if (btnPhone) {
      btnPhone.addEventListener("click", () => {
        setStatus("ç›®å‰å…ˆä½¿ç”¨ä¸Šæ–¹ Apple / Google / LINE / Email ç™»å…¥ï¼Œæ‰‹æ©Ÿç™»å…¥æœƒåœ¨ä¹‹å¾Œé–‹æ”¾ã€‚");
      });
    }

    if (btnEmailToggle && emailSection) {
      btnEmailToggle.addEventListener("click", () => {
        const visible = emailSection.style.display !== "none";
        emailSection.style.display = visible ? "none" : "block";
      });
    }

    if (btnEmailLogin && emailInput && passwordInput) {
      btnEmailLogin.addEventListener("click", async () => {
        const email    = emailInput.value.trim();
        const password = passwordInput.value.trim();

        if (!email || !password) {
          setStatus("è«‹è¼¸å…¥ Email èˆ‡å¯†ç¢¼ã€‚");
          return;
        }
        if (password.length < 6) {
          setStatus("å¯†ç¢¼è‡³å°‘ 6 å€‹å­—ã€‚");
          return;
        }

        try {
          setStatus("Email ç™»å…¥ä¸­ï¼Œè«‹ç¨å€™...");
          await signInWithEmailAndPassword(auth, email, password);
          setStatus("ç™»å…¥æˆåŠŸï¼Œæ­£åœ¨å‰å¾€å€‹äººç°¡ä»‹...");
          window.location.href = AFTER_LOGIN_URL;
        } catch (err) {
          if (err.code === "auth/user-not-found") {
            try {
              setStatus("æ‰¾ä¸åˆ°å¸³è™Ÿï¼Œç‚ºä½ å»ºç«‹æ–°å¸³è™Ÿä¸­...");
              await createUserWithEmailAndPassword(auth, email, password);
              setStatus("è¨»å†Šå®Œæˆï¼Œæ­£åœ¨å‰å¾€å€‹äººç°¡ä»‹...");
              window.location.href = AFTER_LOGIN_URL;
            } catch (err2) {
              console.error("EMAIL SIGNUP ERROR", err2);
              setStatus("è¨»å†Šå¤±æ•—ï¼š" + (err2.message || ""));
            }
          } else {
            console.error("EMAIL LOGIN ERROR", err);
            setStatus("Email ç™»å…¥å¤±æ•—ï¼š" + (err.message || ""));
          }
        }
      });
    }

    if (btnContinuePhone) {
      btnContinuePhone.addEventListener("click", () => {
        setStatus("LINE ç™»å…¥ä¹‹å¾Œæœƒæ¥ä¸Šæ‰‹æ©Ÿç™»å…¥æµç¨‹ï¼Œç¾åœ¨è«‹å…ˆç”¨ Google / LINE æ¸¬è©¦ç™»å…¥æµç¨‹ã€‚");
      });
    }
  </script>
</body>
</html>